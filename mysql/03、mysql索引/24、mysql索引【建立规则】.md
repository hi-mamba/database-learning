
##### [原文1](https://segmentfault.com/a/1190000003072149)

##### [原文2](https://www.jianshu.com/p/9b3406bcb199)

# mysql索引建立规则 及其 注意事项

## mysql索引建立规则

1、表的主键、外键必须有索引；

2、数据量超过300的表应该有索引；

3、`经常与其他表`进行连接的表，在连接字段上应该建立索引

4、`经常出现在Where子句中`的字段，特别是大表的字段，应该建立索引；

5、索引应该建在选择性高(`区分度高`)的字段上；

6、索引应该建在`小字段`上，对于大的文本字段甚至超长字段，不要建索引(如果非要建立索引，限制索引长度【没有必要建立索引】)；

7、复合索引的建立需要进行仔细分析；尽量考虑用单字段索引代替：

- A、正确选择复合索引中的主列字段，一般是选择性较好(`区分度高`)的字段；
- B、复合索引的几个字段是否经常同时以AND方式出现在Where子句中？单字段查询是否极少甚至没有？
如果是，则可以建立复合索引；否则考虑单字段索引；
- C、如果复合索引中包含的字段经常单独出现在Where子句中，则分解为多个单字段索引；
- D、如果`复合索引`所包含的字段`超过3个`，那么仔细考虑其必要性，考虑减少复合的字段；
- E、如果既有单字段索引，又有这几个字段上的复合索引，一般可以删除复合索引;

8、`频繁进行数据操作`的表，`不要建立太多的索引`；

9、`删除无用的索引`，避免对执行计划造成负面影响； 以上是一些普遍的建立索引时的判断依据。


一言以蔽之，索引的建立必须慎重，对每个索引的必要性都应该经过仔细分析，要有建立的依据。

因为太多的索引与不充分、不正确的索引对性能都毫无益处：在表上建立的每个索引都会增加存储开销，

索引对于插入、删除、更新操作也会增加处理上的开销。另外，过多的复合索引，在有单字段索引的情况下，

一般都是没有存在价值的；相反，还会降低数据增加删除时的性能，特别是对频繁更新的表来说，负面影响更大


## 注意事项
#####  范围查询
mysql 会一直向右匹配直到遇到范围查询（`>、<、between、like`）就停止匹配。范围列可以用到索引，但是`范围列后面的列无法用到索引`。
即，索引最多用于一个范围列，因此如果查询条件中有两个范围列则无法全用到索引

##### like 语句的索引问题
如果`通配符 %` 不出现在开头，则`可以用到索引`，但根据具体情况不同可能只会用其中一个前缀
在 like “value%” 可以使用索引，但是 like “%value%” 不会使用索引，走的是全表扫描

##### 不要在列上进行运算
如果查询条件中含有函数或表达式，将导致索引失效而进行全表扫描
例如 select * from user where YEAR(birthday) < 1990
可以改造成 select * from users where birthday <’1990-01-01′

##### 索引不会包含有 NULL 值的列
只要列中包含有 NULL 值都将不会被包含在索引中，`复合索引中只要有一列含有 NULL 值，
那么这一列对于此复合索引就是无效的`。所以在数据库设计时不要让字段的默认值为 NULL

尽量`选择区分度高的列`作为索引，区分度的公式是 count(distinct col)/count(*)，表示字段不重复的比例，
比例越大我们扫描的记录数越少，唯一键的区分度是 1，而一些状态、性别字段可能在大数据面前区分度就是 0。
一般需要 join 的字段都要求区分度 0.1 以上，即平均 1 条扫描 10 条记录

##### 覆盖索引的好处
如果一个索引包含所有需要的查询的字段的值，我们称之为覆盖索引。覆盖索引是非常有用的工具，能够极大的提高性能。
因为，只需要读取索引，而无需读表，极大减少数据访问量

