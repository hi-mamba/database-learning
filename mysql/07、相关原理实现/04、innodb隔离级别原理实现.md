
## [原文](https://ncs123.iteye.com/blog/2396186)

# innodb隔离级别原理实现

> 间隙锁和行锁合称next-key lock，每个next-key lock是前开后闭区间

- 利用MVCC实现一致性非锁定读，这就有保证在同一个事务中多次读取相同的数据返回的结果是一样的，解决了`不可重复读`的问题

- 利用`Gap Locks`（间隙锁）和`Next-Key`可以阻止其它事务在锁定区间内插入数据，因此解决了`幻读`问题

综上所述，默认隔离级别的实现依赖于`MVCC`和`锁`，再具体一点是`一致性读`和`锁`。




在`可重复读`级别下，mvcc完全解决了`重复读`，但**并不能真正的完全`避免幻读`**，只是在部分场景下利用历史数据规避了幻读

对于快照读，mysql使用mvcc利用历史数据部分避免了幻读（在某些场景看上去规避了幻读）

要完全避免，需要`手动加锁将快照读调整为当前读`（mysql不会自动加锁），然后mysql使用next-key完全避免了幻读


## 如何解决幻读？
产生幻读的原因是，`行锁`只能锁住行，但是新插入记录这个动作，要更新的是记录之间的“`间隙`”。
因此，为了解决幻读问题，InnoDB只好引入新的锁，也就是`间隙锁`(Gap Lock)。
 
顾名思义，间隙锁，锁的就是`两个值之间的空隙`。