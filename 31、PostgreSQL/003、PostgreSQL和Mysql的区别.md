## [原文](https://www.zhihu.com/question/20010554)

# 003、PostgreSQL 和 Mysql 的区别

## 区别

- mysql的各种text字段有不同的限制，需要手动区分small text,middle text, large text 

- pg没有该限制，可以支持text的各种大小

- 按照SQL标准，null判断只能用is null,不能用 ==null 

- pg可以设置transform_null_equals 把 = null 翻译成 is null 避免踩坑

- MySQL 的事务隔离级别 repeatable read 并不能阻止常见的并发更新, 得加锁才可以, 但悲观锁会影响性能, 手动实现乐观锁又复杂. 
而 Pg 的列里有隐藏的乐观锁 version 字段, 默认的 repeatable read 级别就能保证并发更新的正确性, 
并且又有乐观锁的性能. 附带一个各数据库对隔离级别的行为差异比较调查

- MySQL 不支持多个表从同一个序列中取 id, 而 Pg 可以.

- MySQL 不支持 OVER 子句, 而 Pg 支持. OVER 子句能简单的解决 “每组取 top 5” 的这类问题.几乎任何数据库的子查询 (subquery) 性能都比 MySQL 好.

- pg它可以存储 array 和 json, 可以在 array 和 json 上建索引, 甚至还能用表达式索引. 为了实现文档数据库的功能, 
设计了 jsonb 的存储结构. 有人会说为什么不用 Mongodb 的 BSON 呢? Pg 的开发团队曾经考虑过, 
但是他们看到 BSON 把 [“a”, “b”, “c”] 存成 {0: “a”, 1: “b”, 2: “c”} 的时候就决定要重新做一个 jsonb 了… 现在 jsonb 的性能已经优于 BSON.

## pg优势

1. pg性能优于mysql（有人说三条街，哈哈哈）相同的数据量计算，pg时间一般只有mysql的四分之一左右（具体情况可能有所不同） 

2. pg对json支持比较好，还有fdw功能，可以吧别的数据库的表当自己的用 

3. 任何系统都有它的性能极限，在高并发读写，负载逼近极限下，PG的性能指标仍可以维持双曲线甚至对数曲线，到顶峰之后不再下降，
而 MySQL 明显出现一个波峰后下滑（5.5版本之后，在企业级版本中有个插件可以改善很多，不过需要付费）。 

4. PG 多年来在 GIS 领域处于优势地位，因为它有丰富的几何类型，实际上不止几何类型，PG有大量字典、数组、bitmap 等数据类型，
相比之下mysql就差很多，instagram就是因为PG的空间数据库扩展POSTGIS远远强于MYSQL的my spatial而采用PGSQL的。 

5. PG 的“无锁定”特性非常突出，甚至包括 vacuum 这样的整理数据空间的操作，这个和PGSQL的MVCC实现有关系。
五、PG 的可以使用函数和条件索引，这使得PG数据库的调优非常灵活，mysql就没有这个功能，条件索引在web应用中很重要。 

6. PG有极其强悍的 SQL 编程能力（9.x 图灵完备，支持递归！），有非常丰富的统计函数和统计语法支持，
比如分析函数（ORACLE的叫法，PG里叫window函数），还可以用多种语言来写存储过程，对于R的支持也很好。
这一点上MYSQL就差的很远，很多分析功能都不支持，腾讯内部数据存储主要是MYSQL，但是数据分析主要是HADOOP+PGSQL（听李元佳说过，但是没有验证过）。 

7. PG 的有多种集群架构可以选择，plproxy 可以支持语句级的镜像或分片，slony 可以进行字段级的同步设置，
standby 可以构建WAL文件级或流式的读写分离集群，同步频率和集群策略调整方便，操作非常简单。 

8. 一般关系型数据库的字符串有限定长度8k左右，无限长 TEXT 类型的功能受限，只能作为外部大数据访问。
而 PG 的 TEXT 类型可以直接访问，SQL语法内置正则表达式，可以索引，还可以全文检索，或使用xml xpath。用PG的话，文档数据库都可以省了。

## 缺点
第一，MySQL有一些实用的运维支持，如 slow-query.log ，这个pg肯定可以定制出来，但是如果可以配置使用就更好了 

第二，mysql的innodb引擎，可以充分优化利用系统所有内存，超大内存下PG对内存使用的不那么充分 

第三，MySQL的复制可以用多级从库，但是在9.2之前，PGSQL不能用从库带从库。第四点，从测试结果上看，
mysql 5.5的性能提升很大，单机性能强于pgsql，5.6应该会强更多.第五点，对于web应用来说,mysql 5.6 的内置MC API功能很好用，PGSQL差一些。


 