


## [原文](https://www.jianshu.com/p/702e8659513b)

# 数据库连接池实现


最原始的数据库连接就是我们打开一个连接，使用过后再关闭该链接来释放资源。
频繁的新建打开再关闭连接对jvm和数据库都有一定的资源负荷，
尤其是应用压力比较大的时候占用过多的资源容易产生性能问题。
所以引入数据库连接池，

它的原理就是：

先打开一定数量的数据库连接，当使用的时候分配给使用者，
使用结束后返回给连接池，注意返回的时候不需要关闭这些连接，而是准备给下一个调用者分配。
这样就省去了大量的数据库连接打开和关闭的操作，提升了系统的性能。

- 最小连接数：应用启动后就打开的数据库连接的数量以及后续最小维持的连接数

- 最大连接数：应用能够打开的最多的连接数

- 连接增长数：应用每次打开新连接的个数

## 最大连接数和最新连接数

- 最小连接数是连接池一直保持的数据连接。如果应用程序对数据库连接的使用量不大，
将会有大量的数据库连接资源被浪费掉。

- 最大连接数是连接池能申请的最大连接数。如果数据连接请求超过此数，
后面的数据连接请求将被加入到等待队列中，这会影响之后的数据库操作。



如果最小连接数与最大连接数相差太大，那么，最先的连接请求将会获利，
之后超过最小连接数量的连接请求等价于建立一个新的数据库连接。
不过，这些大于最小连接数的数据库连接在使用完不会马上被释放，
它将被放到连接池中等待重复使用或是空闲超时后被释放。
上面的解释，可以这样理解：数据库池连接数量一直保持一个不少于最小连接数的数量，当数量不够时，
数据库会创建一些连接，直到一个最大连接数，之后连接数据库就会等待。

## 假如项目最大并发3000，想知道怎么设置需要？

把系统运行起来，你自己写监听，统计一段时间内的连接池，然后查看最大的，最小的和平均值，
根据这些获得的参数信息来确定。

## 举个例子说明连接池的运作：

假设设置了最小和最大的连接为10，20，那么应用一旦启动则首先打开10个数据库连接，
但注意此时数据库连接池的正在使用数字为0--因为你并没有使用这些连接，而空闲的数量则是10。
然后你开始登录，假设登录代码使用了一个连接进行查询，
那么此时数据库连接池的正在使用数字为1、空闲数为9，
这并不需要从数据库打开连接--因为连接池已经准备好了10个给你留着呢。
登录结束了，当前连接池的连接数量是多少？
当然是0，因为那个连接随着事务的结束已经返还给连接池了。
然后同时有11个人在同一秒进行登录，会发生什么：连接池从数据库新申请（打开）了一个连接，
连同另外的10个一并送出，这个瞬间连接池的使用数是11个，不过没关系正常情况下过一会儿又会变成0。
如果同时有21个人登录呢？那第21个人就只能等前面的某个人登录完毕后释放连接给他。
这时连接池开启了20个数据库连接--虽然很可能正在使用数量的已经降为0，那么20个连接会一直保持吗？
当然不，连接池会在一定时间内关闭一定量的连接还给数据库，
在这个例子里数字是20-10=10，因为只需要保持最小连接数就好了，
而这个时间周期也是连接池里配置的。

 
 