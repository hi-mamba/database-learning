
原文：<https://mp.weixin.qq.com/s/Qc4t_-_pL4w8VlSoJhRDcg>

# Redis 提供了 3 种刷盘机制

为了保证 AOF 文件数据的安全性，Redis 提供了 3 种刷盘机制：


## appendfsync always
主线程每次执行写操作后`立即刷盘`，
此方案会占用比较大的磁盘 IO 资源，但数据安全性最高

## appendfsync no
主线程每次写操作只写内存就返回，`内存数据什么时候刷到磁盘，
交由操作系统决定`，此方案对性能影响最小，但数据安全性也最低，
Redis 宕机时丢失的数据取决于操作系统刷盘时机
> 如果你的 Redis 只用作纯缓存，对于数据丢失不敏感，采用配置 appendfsync no 也是可以的。

## appendfsync everysec
主线程每次写操作只写内存就返回，
然后`由后台线程每隔 1 秒执行一次刷盘操作`（触发 fsync 系统调用），
此方案对性能影响相对较小，但当 Redis 宕机时会丢失 1 秒的数据

> 当子进程在 AOF rewrite 期间，可以`让后台子线程不执行刷盘`（不触发 fsync 系统调用）操作。
开启这个配置项，在 `AOF rewrite` 期间(AOF文件内存)，如果实例发生宕机，
那么此时会丢失更多的数据，性能和数据安全性，你需要权衡后进行选择。
